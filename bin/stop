#!/bin/zsh

# This takes a given pid file and tries to stop the associated process

TIMEOUT=10

function stop_process () {
    local pid=$1
    local cmd=$2
    local timeout=$3

    if ps -p ${pid} >/dev/null
    then
        eval $(printf ${cmd} ${pid})

        local count=0
        while ps -p ${pid}
        do
            count=$((${count} + 1))
            if [ ${count} -gt 10 ]
            then
                return 1
            fi
        done
        echo "Process ${pid} stopped"
        return 0
    else
        echo "No process with id ${pid} found"
        return 0
    fi
}

for pid in $@
do
    if ! stop_process ${pid} "kill %d" ${TIMEOUT}
    then
        if ! stop_process ${pid} "kill -9 %d" ${TIMEOUT}
        then
            echo "kill -9 was not able to stop the process!"
            return 1
        fi
    fi
done
return 0
